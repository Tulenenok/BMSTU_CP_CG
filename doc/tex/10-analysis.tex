\chapter{Аналитический раздел}
В данном разделе представлено описание объектов сцены, а также обоснован выбор алгоритмов, которые будут использованы для ее визуализации. 

\section{Описание объектов сцены}

Сцена состоит из одного или нескольких источников света, а также модели растения.

Источник света представляется в виде материальной точки, которая испускает лучи во все стороны. Если он устанавливается на «бесконечном» удалении от сцены, на сцену попадает множество параллельных лучей. В
программе источники света будут играть роль студийных проекторов, однако визуализировать их не планируется.

Модель растения будет задана набором правил, описывающих в математическом виде процесс построения этого растения, также цветом и формой примитива, которым нужно отрисовать растение.

\section{Анализ и выбор формы задания трехмерных моделей}
Модель является отображением формы и размеров объекта. 
В основном используются три вида моделей:

\begin{enumerate}
	\item Каркасная (проволочная) модель.
	
    Такой тип модели использует информацию о вершинах и ребрах объектов. Это простейшая форма задания модели, так как мы храним минимум информации. Недостаток такого подхода состоит в том, что модель не всегда точно передает представление о форме объекта.
	\newpage
	\item Поверхностная модель.
	
	Наиболее часто используемый тип моделей в компьютерной графике. Поверхности можно задавать разными способами: либо аналитически, либо задавать участки поверхности, как поверхность того или иного вида (использовать полигональную аппроксимацию). Недостаток - мы не знаем, с какой стороны находится материал. 
	
	\item  Объемная (твердотельная) модель.
	
	При твердотельном моделировании учитывается еще материал, из которого изготовлен объект. То есть у нас есть информация о том, с какой стороны поверхности расположен материал. Это делается с помощью указания направления внутренней нормали.

\end{enumerate}

\subsection*{Вывод}	
Для решения данной задачи были выбраны поверхностные модели, так как у каркасных моделей есть серьезный недостаток – неправильное восприятие формы, а объемные модели слишком информативны и ресурсоемки.

\section{Анализ способа задания поверхностных моделей}
На следующем шаге необходимо определиться со способом задания поверхностной модели.

\subsection{Аналитический способ}

 Этот способ задания модели характеризуется описанием модели объекта, которое доступно в неявной форме, то есть для получения визуальных характеристик необходимо дополнительно вычислять некоторую функцию, которая зависит от параметра.

\subsection{Полигональная сетка}

 Данный способ характеризуется совокупностью вершин, граней и ребер, которые определяют форму многогранного объекта в трехмерной компьютерной графике.

Возможные способы хранения информации о сетке:

\begin{enumerate}

\item Список граней. 

Объект – это множество граней и множество вершин. В каждую грань входят как минимум 3 вершины;
\item«Крылатое» представление. 

Каждая точка ребра указывает на две вершины, две грани и четыре ребра, которые её касаются.

\item Полурёберные сетки.

 То же «крылатое» представление, но информация обхода хранится для половины грани.
 
\item Таблица углов.

 Это таблица, хранящая вершины. Обход заданной таблицы неявно задаёт полигоны. Такое представление более компактно и более производительно для нахождения полигонов, но, в связи с тем, что вершины присутствуют в описании нескольких углов, операции по их изменению медленны.
 
\item Вершинное представление.

 Хранятся лишь вершины, которые указывают на другие вершины. Простота представления даёт возможность проводить над сеткой множество операций.

\end{enumerate}

\subsection*{Вывод}
Стоит отметить, что одним из решающих факторов в выборе способа задания модели в данном проекте является скорость выполнения преобразований над объектами сцены. Поэтому при реализации программного продукта в данной работе наиболее удобным представлением является модель, заданная полигональной сеткой – это поможет избежать проблем при описании сложных моделей. При этом способ хранения полигональной сетки -- это списком полигонов из трех вершин, что поможет при реализации алгоритма удаления невидимых рёбер и поверхностей. Этот способ позволит эффективно преобразовывать модели, так как структура будет включать в себя список вершин. 


\section{Анализ и выбор алгоритма удаления \\ невидимых ребер и поверхностей}

Выбирая алгоритм удаления невидимых ребер и поверхностей, в первую очередь нужно выделить свойства, которыми должен обладать итоговый алгоритм, чтобы обеспечить оптимальную работу программы и реалистичное изображение. При анализе были выделены следующие свойства:
\begin{itemize}
\item	алгоритм должен быть достаточно быстрым;
\item	алгоритм должен использовать как можно меньше памяти;
\item	алгоритм должен иметь высокую реалистичность изображения.
\end{itemize}

\subsection{Алгоритм, использующий Z-буфер}
Суть алгоритма Z-буфера \cite{zbufer} -- это использование двух буферов: буфера
кадра, в котором хранятся атрибуты каждого пикселя, и Z-буфера, в котором
хранятся информация о координате Z для каждого пикселя.

Первоначально в Z-буфере находятся минимально возможные значения
Z, а в буфере кадра располагаются пиксели, описывающие фон. Каждый
многоугольник преобразуется в растровую форму и записывается в буфер
кадра.

В процессе подсчета глубины нового пикселя, он сравнивается с тем
значением, которое уже лежит в Z-буфере. Если новый пиксель расположен
ближе к наблюдателю, чем предыдущий, то он заносится в буфер кадра и
происходит корректировка Z-буфера.

Для решения задачи вычисления глубины Z каждый многоугольник
описывается уравнением $ax + by + cz + d = 0$. При $c = 0$, многоугольник для
наблюдателя вырождается в линию.

Преимуществами данного алгоритма являются простота реализации, а также линейная оценка трудоемкости.

Недостатки алгоритма -- большой объем требуемой памяти и сложная реализация прозрачности.

\subsection{Алгоритм обратной трассировки лучей} 
Суть данного алгоритма -- наблюдатель видит объект с помощью испускаемого света, который согласно законам оптики, доходит до наблюдателя некоторым путем.
Отслеживать пути лучей от источника к наблюдателю неэффективно с точки зрения вычислений, поэтому наилучшим способом будет отслеживание лучей в обратном направлении, то есть от наблюдателя к объекту.

Метод обратной трассировки лучей позволяет значительно сократить перебор световых лучей. В этом случае трассируется определенное число лучей, равное разрешению картинки \cite{raytrace}.

Преимуществами данного алгоритма являются высокая реалистичность синтезируемого изображения и возможность работать с поверхностями в математической форме. Также важно отметить, что вычислительная сложность данного алгоитма слабо зависит от сложности сцены.

Основным недостатком алгоритма является низкая производительность.

\subsection{Алгоритм Робертса}
Данный алгоритм работает в объектном пространстве, решая задачу
только с выпуклыми телами. \cite{roberts} 
\newpage
Алгоритм выполняется в три этапа:
\begin{enumerate}
    \item Этап подготовки исходных данных (информации о телах).
    \item Этап удаления ребер, экранируемых самим телом.
    \item Этап удаления невидимых ребер, экранируемых другими телами
сцены.
\end{enumerate}

Преимущество алгоритма Робертса в том, что он целиком основан на математических предпосылках, которые просты, точны и мощны. Он работает в объектном пространстве и позволяет получить высокую точность вычислений.

К недостаткам этого алгоритма можно отнести большую трудоемкость, невозможность работы с невыпуклыми телами, а также тот факт, что без модификации и привлечения сторонних методов данный алгоритм не позволяет учитывать тени и зеркальные эффекты.

\subsection{Алгоритм художника}
Данный алгоритм работает аналогично тому, как художник рисует картину – то есть сначала рисуются дальние объекты, а затем более близкие. Наиболее распространенная реализация алгоритма – сортировка по глубине, которая заключается в том, что произвольное множество граней сортируется по ближнему расстоянию от наблюдателя, а затем отсортированные грани выводятся на экран в порядке от самой дальней до самой ближней. Данный метод работает лучше для построения сцен, в которых отсутствуют пересекающиеся грани \cite{hudognik}. 

Основным преимущетсвом данного алгоритма является тот факт, что он требует меньше памяти, чем, например, алгоритм Z-буфера. 

Недостаки -- недостаточно высокая реалистичность изображения и сложность реализации при пересечении граней на сцене.

\subsection{Алгоритм Варнока}

Алгоритм Варнока \cite{varnok} работает в пространстве изображения и основывается на рекурсивном разбиении экрана. Главная идея - на каждом шаге найти ответ на вопрос о том, что изображать в очередном окне. Если нельзя точно дать ответ, то окно делится на части, пока не сможем решить, что изображать, или окно не дойдёт до размеров в один пиксель.

В простейшей версии алгоритма окно делится на подокна всякий раз, если это окно не пусто. В более сложных версиях делается попытка решения задачи для окон большего размера. Для этого проводится классификация
многоугольников по отношению к ячейке: внешний, внутренний, пересекающий или охватывающий. Затем определяются действия, которые нужно предпринять
в том или ином случае взаимного расположения ячейки и полигонов.

Достоинством данного алгоритма является простота реализации и высокая эффективность в случае, если размеры перекрываемых областей невелики.

К недостаткам алгоритма относится трудоемкость в случае, когда синтезируемая сцена сложная и число разбиений становится очень большим, а также отсутствие учета оптических свойств объектов.
 
 
\subsection*{Вывод}
Для удаления невидимых линий был выбран алгоритм Z-буфера. Данный алгоритм работает достаточно быстро из-за отсутствия сортировок, позволяет добиться хорошей реалистичности, а также достаточно прост в реализации


\section{Анализ и выбор модели освещения}

Существует два вида моделей материалов: физические модели и эмпирические. 

Физические модели материалов стараются аппроксимировать свойства некоторого реального материала. Такие модели учитывают или особенности поверхности материала или поведение частиц материала.

Эмпирические модели материалов устроены иначе. Подобные модели подразумевают некий набор параметров, не имеющих физической интерпретации, но позволяющих с помощью подбора получить нужный вид модели.

Рассмотрим эмпирические модели, а конкретно модель Ламберта и модель Фонга.

\subsection{Модель Ламберта}

Модель Ламберта \cite{lamber_fong} моделирует идеальное диффузное освещение, то есть свет при попадании на поверхность рассеивается равномерно во все стороны. При такой модели освещения учитывается только ориентация поверхности ($N$) и направление источника света ($L$). Иллюстрация данной модели представлена на рисунке \ref{img:mod_lam}.

\img{70mm}{mod_lam}{Направленность источника света}

Эта модель является одной из самых простых моделей освещения и очень часто используется в комбинации с другими моделями. Она может быть очень удобна для анализа свойств других моделей, за счет того, что ее легко выделить из любой модели и анализировать оставшиеся составляющие.

\subsection{Модель Фонга}

Модель Фонга \cite{lamber_fong} представляет собой комбинацию диффузной и зеркальной составляющих. Падающий и отраженный лучи лежат в одной плоскости с
нормалью к отражающей поверхности в точке падения (\ref{img:mod_fong}). Нормаль
делит угол между лучами на две равные части. L – направление источника света, R – направление отраженного луча, V – направление на наблюдателя.

\img{70mm}{mod_fong}{Направленность источника света}

Работает модель таким образом, что кроме равномерного освещения на материале могут появляться блики. Местонахождение блика на объекте определяется из закона равенства углов падения и отражения. Чем ближе
наблюдатель к углам отражения, тем выше яркость соответствующей точки.

\subsection*{Вывод}
Для освещения была выбрана модель Ламберта, так как по сравнению с моделью Фонга она требует меньше вычислительных затрат, и, следовательно,
работает быстрее.

\section*{Вывод}
В данном разделе был проведен анализ алгоритмов удаления невидимых линий и модели освещения, которые возможно использовать для решения поставленных задач. В качестве ключевого алгоритма удаления невидимых граней выбран алгоритм Z-буфера, а в качестве модели освещения - модель освещения Ламберта. 
